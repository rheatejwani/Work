---
title: "Spotify Music Project"
author: "RiSK: Rhea Tejwani, Sue Zhang, Keena Gao"
date: "10/25/20"
output: pdf_document
---

Questions:
What can we improve
Linear regression and interactive model graph


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)
```

### Introduction and Data

Music is one of the most accessible ways to experience and communicate emotional experiences and opinions across cultural norms and language barriers. Popular music is especially able to broadcast its message, but popularity depends on the breadth of people that enjoy listening to it. 

Trends in popular music are constantly changing, and these changes will affect globalization and cultural communication. For instance, hip-hop music, an aspect of the hip-hop cultural movement, was stated to be the most popular genre of music in the U.S. in 2017 in this Rolling Stone article: https://www.rollingstone.com/music/music-news/hip-hop-continued-to-dominate-the-music-business-in-2018-774422/. As students who frequently listen to music, we want to analyze the trends of popular music in our generation and the generations before us.

The data that we chose to analyze was curated by Sumat Singh (@iamsumat) on Kaggle, and contains variables that measure various characteristics of the most popular music in the world over the years 1956 to 2019 on the streaming service Spotify. https://www.kaggle.com/iamsumat/spotify-top-2000s-mega-dataset 

The original data set was taken from the playlist on Spotify "Top 2000s" by the user PlaylistMachinery (@plamere) using Selenium with Python. It was scraped from http://sortyourmusic.playlistmachinery.com/. This data was uploaded 9 months ago.

This data set has 15 columns and 1994 rows. The observations in the data set describe the characteristics of the top 2000 most popular songs from 1956 to 2019 from Spotify. 

The variables we will be focusing on are `acousticness`, which is a measure from 0 to 100 representing the confidence that the track is acoustic (with 100 being high confidence), `year`, which is the year the track was popular in, and `genre`, which is the genre of the music. We expanded upon our chosen variables in the metholody section of this report.

Our research question: Has popular music shifted to be more diverse in characteristics such as the genre and acousticness? The goal of our report is to observe how these characteristics changed over time and how these variables may affect one another.
  

### Methodology

There are no missing data values so we don't have to clean the data. We will create new variables using the mutate and case_when functions as follows:
decade: the decade as named by "50s", "60s", etc
period: "oldies" for before 1990 and "present" for after 1989
foreign_lang: categorical variable("TRUE" for any song whose genre has a foreign country/language in it, "FALSE" otherwise)
broad genre: broad category "pop" or "rock" or etc
sd: standard deviation of Acousticness per year (grouped by foreign language)

We will use dplyr functions to explore our data set in terms of summarising the variance, counting different variables and visualizing them. We are looking for unusual patterns or clusters of observations whose relationships we can further explore through hypothesis testing. 

```{r load-packages-and-data}
library(tidyverse)
library(infer)
library(broom)
spotify_data <- read_csv("data/Spotify-2000.csv")
```

```{r decade-variable}
spotify_data <- spotify_data %>%
  mutate(decade = case_when(Year >= 1956 & Year <= 1959 ~ " 50s",
                            Year >= 1960 & Year <= 1969 ~ " 60s",
                            Year >= 1970 & Year <= 1979 ~ " 70s",
                            Year >= 1980 & Year <= 1989 ~ " 80s",
                            Year >= 1990 & Year <= 1999 ~ " 90s",
                            Year >= 2000 & Year <= 2009 ~ "2000s",
                            Year >= 2010 & Year <= 2019 ~ "2010s",))
```

```{r foreign_languages_variable}
spotify_data <- spotify_data %>%
  mutate(foreign_lang = 
    `Top Genre` == "dutch indie" | `Top Genre` == "dutch cabaret" 
    | `Top Genre` == "dutch pop" |`Top Genre` == "dutch americana" |
      `Top Genre` == "german pop"|`Top Genre` == "dutch rock" |
      `Top Genre` == "belgian rock" | `Top Genre` == "finnish metal"|
      `Top Genre` == "german pop rock" | `Top Genre` == "german alternative rock" |`Top Genre` == "italian pop" | `Top Genre` == "latin" |
      `Top Genre` == "latin alternative"| `Top Genre` == "latin jazz"
  )

```

```{r foreign_lang_01}
spotify_data <- spotify_data %>%
  mutate(foreign_lang_factor = case_when(foreign_lang == "TRUE" ~ 1, 
                                         foreign_lang == "FALSE" ~ 0))
```

```{r year-since-1956}
spotify_data <- spotify_data %>%
  mutate(year = Year - 1956)
```


```{r past-present-variable}
spotify_data <- spotify_data %>%
  mutate(period = case_when(Year >= 1956 & Year <= 1959 ~ "Oldies",
                            Year >= 1960 & Year <= 1969 ~ "Oldies",
                            Year >= 1970 & Year <= 1979 ~ "Oldies",
                            Year >= 1980 & Year <= 1989 ~ "Oldies",
                            Year >= 1990 & Year <= 1999 ~ "Present",
                            Year >= 2000 & Year <= 2009 ~ "Present",
                            Year >= 2010 & Year <= 2019 ~ "Present",))
```

```{r clustered-genre-variable}
spotify_data <- spotify_data %>%
  mutate(broad_genre = case_when(
    `Top Genre` == "album rock"|`Top Genre` == "dutch rock" |
      `Top Genre` == "belgian rock" |  `Top Genre` == "german pop rock"
    | `Top Genre` == "german alternative rock"|  `Top Genre` == "classic rock"|
    `Top Genre` == "alternative pop rock"| `Top Genre` == "modern rock"|
      `Top Genre` == "alternative rock"| `Top Genre` == "garage rock"|
      `Top Genre` == "modern folk rock"| `Top Genre` == "irish rock"|
      `Top Genre` == "art rock"| `Top Genre` == "danish pop rock"|
      `Top Genre` == "celtic rock"| `Top Genre` == "blues rock"|
      `Top Genre` == "soft rock"| `Top Genre` == "glam rock" ~ "rock",
    `Top Genre` == "acoustic pop"|`Top Genre` == "dutch pop" |
      `Top Genre` == "barbadian pop" |  `Top Genre` == "folk-pop" 
    | `Top Genre` == "electropop"| `Top Genre` == "belgian pop"|
    `Top Genre` == "pop"| `Top Genre` == "chamber pop"|
      `Top Genre` == "irish pop"| `Top Genre` == "indie pop"|
      `Top Genre` == "canadian pop"| `Top Genre` == "danish pop"|
      `Top Genre` == "art pop"| `Top Genre` == "dance pop"|
      `Top Genre` == "italian pop"| `Top Genre` == "la pop"|
      `Top Genre` == "german pop"| `Top Genre` == "baroque pop"|
      `Top Genre` == "austropop"|`Top Genre` == "australian pop"|
      `Top Genre` == "classic uk pop"|`Top Genre` == "bubblegum pop"|
      `Top Genre` == "europop" ~ "pop", 
      TRUE ~ "Other"
  ))
```

```{r pop-nonpop}
spotify_data<- spotify_data %>%
  mutate(pop = case_when(broad_genre == "pop" ~ 1,
                         broad_genre == "rock" | broad_genre == "Other" ~ 0))
```


```{r variance-per-year}
spotify_data <- spotify_data %>%
  group_by(Year) %>%
  mutate(sd=sd(Acousticness))
```


```{r visualized_genres}
ggplot(data = spotify_data, mapping = aes(x = decade, fill = broad_genre)) +
  geom_bar(position = "fill")+
    labs(x = "Decade", 
      title = "Broad Genre of Popular Music")
```
The proportion of rock as a popular song genre was highest in the 70s and has decreased since then. The proportion of pop has increased slightly since the 60s. The dataset was started midway through the 50s so there aren't as many data points for genre as the other decades. 

```{r acousticness-boxplot}
  ggplot(data = spotify_data, mapping = aes(x = decade, y = Acousticness, fill = decade)) +
         geom_boxplot() +
  labs(title = "Acousticness vs. Decade")
```

Older music tends to have a higher median value for acousticness. The median acousticness has remained relatively constant from the 80s to the 2010s. Additionally, from the 80s to the 2010s, the majority of the IQR overlaps. This could be due to an increase in technology used in music production in the modern era.

```{r foreign-langauge}
spotify_data %>%
  group_by(decade) %>%
  count(foreign_lang)
```
```{r visualized-foreign-lang}
ggplot(data = spotify_data, mapping = aes(x = decade, fill = foreign_lang)) +
  geom_bar(position = "fill")+
    labs(x = "Decade", 
      title = "Proportion of Foreign Language Songs in Popular Music")
```
The proportion of popular foreign language songs has increased over time. We will further investigate this in the methodology section.


### Results

We will look at the correlation, standard deviations, and IQR of the acousticness variable. We will also analyze the changes in genre across the decade through simulation based tests. We will visualize our data using ggplot with scatterplots, boxplots and histograms. We will try to use linear models and the tools from library(broom). We can use summary statistics to find the mean, median and range of our data. We will also use the library(tidyverse) functions to explore our data set. We will find the p-value and use hypothesis tests to analyze the statistical significance of our tests. 

We will be using the variable `sd`, which is the standard deviation of the `Acousticness` of the songs in our dataset. 


###Hypothesis test for genre (foreign language)

H0: The proportion of popular foreign language songs in the modern decades is equal to the proportion of popular foreign language songs in the older decades ($\rho_m = \rho_o$, where $\rho_m$ is the proportion of popular foreign language songs in the modern decades and $\rho_o$ the proportion of popular foreign language songs in the older decades)

Ha: The proportion of popular foreign language songs in the modern decades is greater than the proportion of popular foreign language songs in the older decades ($\rho_m > \rho_o$, where $\rho_m$ is the proportion of popular foreign language songs in the modern decades and $\rho_o$ the proportion of popular foreign language songs in the older decades)

Alpha: 0.05 ($\alpha = 0.05$)

```{r simulation-test}
set.seed(1234)
null_dist <- spotify_data %>%
  specify(foreign_lang~period, success = "TRUE") %>%
  hypothesize(null="independence") %>%
  generate(reps=1000, type = "permute") %>%
  calculate(stat="diff in props", order = c("Present", "Oldies"))
null_dist
```

```{r p-value}
obs_diff <- spotify_data %>%
  specify(foreign_lang~period, success="TRUE") %>%
  calculate(stat="diff in props", order= c("Present", "Oldies"))%>%
  pull()

null_dist %>%
  filter(stat > obs_diff) %>%
  summarise(p_val = n()/nrow(null_dist))
```

The p-value is very small, which is less than the pre-determined alpha level of 0.05, so we reject the null hypothesis. There is sufficient evidence to conclude that the proportion of popular foreign language songs in the modern decades is greater than the proportion of popular foreign language songs in the older decades.

###Linear model for acousticness

```{r linear-model}
acousticness_model <- lm(sd ~ year, data=spotify_data)
  tidy(acousticness_model)
```
The linear equation for the model is $\widehat{Acousticness}= 25.842 +0.0596 \times year$

The intercept of this graph is when the year is 1956, we expect the standard deviation for acousticness to be 25.842, holding all else constant. For each additional year, we expect the standard deviation of acousticness to increase by 0.0596, holding all else constant.


```{r model-visualization-1}
ggplot(data=acousticness_model, mapping=aes(x = year, y=sd)) +
  geom_point() +
  geom_smooth(method="lm", se=FALSE) +
  labs(title="Standard Deviation vs. Year", x="Year since 1956", y="Standard Deviation (of Acousticness)")
```
The standard deviation in the acousticness of popular songs has increased over time.


```{r var-foreign-time}
acousticness_year_pop <- lm(sd ~ year + pop + year*pop, data=spotify_data)
  tidy(acousticness_year_pop)
```

$\widehat{Acousticness}= 25.858 + 0.059 \times year - 0.113 \times foreign_lang_factor - 0.003 \times year:foreign_lang_factor$

The intercept of this graph is when the year is 1956, we expect the standard deviation for acousticness to be 25.858, holding all else constant. For each additional year, we expect the standard deviation of acousticness to increase by 0.059, holding pop constant. We expect pop songs to have a standard deviation of acousticness that is 0.113 less than songs that are not pop, on average, holding year constant. **EXPLAIN INTERACTION**

```{r}
ggplot(data=acousticness_year_pop, mapping=aes(x = year, y=sd, color=as.factor(pop))) +
  geom_point() +
  geom_abline(slope=0.05913789, intercept=25.85778059, color="red")+
  geom_abline(slope=(0.05913789	+ 0.00277569), intercept= (25.85778059	-0.11327760), color="dark cyan")+
  labs(title="Standard Deviation vs. Year", subtitle="colored by 'pop'", x="Year", y="Standard Deviation (of Acousticness)")
```


R-squared values for the models:

```{r glance-main}
glance(acousticness_model) %>%
  select(r.squared, adj.r.squared)
```

```{r glance-int}
glance(acousticness_year_pop) %>%
  select(r.squared, adj.r.squared)
```



### Discussion

LIMITATIONS: Some limitations of our analysis include other factors which are not variables or included in our modeling and the limited number of samples in our data set. 

**say something about the 50s

(Add paragraph about what we would do differently in the final draft)